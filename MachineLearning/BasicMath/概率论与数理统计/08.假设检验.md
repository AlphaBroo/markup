# 假设检验

在一个已知的假设下，一个特定条件发生的概率格外小，我们就认为这个假设可能 不对。

实际推断的原理：概率很小的事件在一次试验中实际上几乎是不发生的。

## 假设检验

- 概念

**零假设** 是假定一个总体参数等于某个特定值的一个声明，用 $H_0$ 表示

**备择假设** 是假定改总体参数为零假设中假设的值除外的值，用 $H_1$ 表示

> 零假设和备择假设的选择
>
> 1.零假设取有等号的假设
>
> 2.若是希望假设的论断成立，设为备择假设；若是希望假设的论断不成立，设为零假设

**检验统计量** 是一个用于确定零假设是否为真的一个值 ，这个值在假定零假设为真时由样本数据计算得到。

**拒绝域** 是指检验统计量所有可以拒绝零假设的取值所构成的集合，也称否定域

**显著水平 ** 是指当零假设正确的时候，检验统计量落在拒绝域的概率。也就是当零假设为真而我们却拒绝零假设这种错误发生的概率。用 $\alpha$ 表示

**临界值** 是拒绝域与非拒绝域的分界线

**双侧检验** 是拒绝域落在分布两边的尾部

**左侧检验** 是拒绝域落在分布左边的尾部

**右侧检验** 是拒绝域落在分布右边的尾部

**p值** 是当原假设为真时所得到的样本观察结果或更极端结果出现的概率。

**第一类错误** 是零假设正确的情况下拒绝了零假设，犯错概率为 $\alpha$

**第二类错误** 是零假设错误的情况下没有拒绝零假设，犯错概率为 $\beta$

在显著水平 $\alpha$ 下，检验假设
$$
H_0:\mu=\mu_0,H_1:\mu\neq{\mu_0}
$$
也常说成“在显著水平 $\alpha$ 下，针对 $H_1$ 检验 $H_0$”。$H_0$称为**原假设**或**零假设**，$H_1$ 称为**备择假设**（意指在原假设被拒绝后可供选择的假设）。

当检验统计量取某个区域 $C$ 中的值时，我们拒绝原假设 $H_0$，则称区域 $C$ 为**拒绝域**，拒绝域的边界点称为**临界点**.

由于检验法则是根据样本作出的，总有可能作出错误的决策。在假设 $H_0$ 实际为真，我们可能犯拒绝 $H_0$ 的错误，这类“弃真” 的错误为**第一类错误**。犯这种错误的概率记为
$$
P\{当H_0为真拒绝H_0\} \ 或 \ P_{\mu_0}\{拒绝H_0\} \ 或 \ P_{\mu\in{H_0}}\{拒绝H_0\}
$$
当 $H_0$ 实际上不真时，我们也有可能接受 $H_0$，称这类“取伪”的错误为**第二类错误**。犯这种错误的概率记为
$$
P\{当H_0为不真接受H_0\} \ 或 \ P_{\mu\in{H_1}}\{接受H_0\}
$$
为此，在确定检验法则时，要尽可能使犯两类错误的概率都较小。但是，一般来说，当样本容量固定使，若减小犯一类错误的概率，则犯另一类错误的概率往往增大。若要使犯两类错误的概率都减小，除非增加样本容量。在给定样本容量的情况下，一般来说，我们总是控制犯第 $1$ 类错误的概率。这种只对犯第 $1$ 类错误的概率加以控制，而不考虑犯第 $2$ 类错误的概率的检验，称为**显著性检验**。

备择假设 $H_1$ 表示 $\mu$ 可能大于 $\mu_0$，也可能小于 $\mu_0$，称为**双边备择假设**，上面的假设检验为**双边假设检验**。

检验假设
$$
H_0:\mu\leq{\mu_0},H_1:\mu>{\mu_0}
$$
称为**右边检验**。

检验假设
$$
H_0:\mu\geq{\mu_0},H_1:\mu<{\mu_0}
$$
称为**左边检验**。

右边检验和左边检验统称为**单边检验**。

- 处理参数的假设检验问题的步骤

1. 根据实际问题的要求，提出原假设 $H_0$ 及备择假设 $H_1$.
2. 给定显著水平 $\alpha$ 以及样本容量 $n$
3. 确定检验统计量以及拒绝域的形式
4. 按 $P\{ 当H_0 为真拒绝H_0\}\leq{\alpha}$ 求出拒绝域

## 总体比例的假设检验

- 单个总体

适用条件：

1. 样本是一个简单随机样本
2. 满足二项分布的条件
3. 满足 $np\geq 5, nq \geq 4$ （满足此条件，二项分布可以使近似 $N(np, npq)$）

$n$：试验测试，$\hat{p}=\frac{x}{n}$：样本比例，$p$：总体比例，$q:1-p$

设定零假设与备择假设
$$
H_0:p=p_0,H_1:p>p_0
$$
检验统计量
$$
z=\frac{\hat{p}-p}{\sqrt{\frac{pq}{n}}} \sim N(0,1)
$$

> 临界值法

拒绝域为
$$
(z_{1-\alpha}, \infty)
$$
若 $z_0>z_{1-\alpha}$，则落在拒绝域中，拒绝零假设

> p值法

$$
P\{Z>z_0\}<\alpha
$$

故拒绝零假设

- 两个独立总体

适用条件：

1. 两个样本为相互独立的简单随机样本
2. 对于每个样本，成功个数和失败个数都大于等于5

设定零假设和备择假设
$$
H_0：p_1=p_2,H_1:p_1>p_2
$$
检验统计量
$$
\bar{p} = \frac{x_1+x_2}{n_1+n_2},\bar{q}=1-\bar{p} \\
z = \frac{(\hat{p_1}-\hat{p_2})-(p_1-p_2)}{\sqrt{\frac{\bar{p}\bar{q}}{n_1}+\frac{\bar{p}\bar{q}}{n_2}}} \sim N(0,1)
$$

> 临界值法

拒绝域
$$
(z_{1-\alpha},\infty)
$$
若 $z_0>z_{1-\alpha}$ ，则落在拒绝域中，故拒绝零假设

> p值法

$$
P\{Z>z_0\}<\alpha
$$

故拒绝零假设


## 正态总体均值的假设检验

- 单个总体

1. $\sigma^2$ 已知（$Z$ 检验）

设总体 $X\sim{N(\mu,\sigma^2)}$，其中 $\sigma^2$ 已知，求检验问题
$$
H_0:\mu=\mu_0,H_1:\mu\neq{\mu_0}
$$
的拒绝域。

我们用 $Z=\frac{\bar{X}-\mu_0}{\sigma/\sqrt{n}}$ 作为检验统计量，
$$
P\{当H_0为真拒绝H_0\} = P_{\mu_0}\{|\frac{\bar{X}-\mu_0}{\sigma/\sqrt{n}}|\geq{k}\}=\alpha
$$
由于当 $H_0$ 为真时，$Z=\frac{\bar{X}-\mu_0}{\sigma/\sqrt{n}}\sim{N(0,1)}$，由标准正态分位点的定义得 $k=z_{\alpha/2}$

因此，拒绝域为

$$
|z|\geq{z_{\alpha/2}}
$$
此方法称为 $Z$ **检验法**

2. $\sigma^2$ 未知（ $t$ 检验）

设总体 $X\sim{N(\mu,\sigma^2)}$，其中 $\mu,\sigma^2$ 未知，求检验问题
$$
H_0:\mu=\mu_0,H_1:\mu\neq{\mu_0}
$$
的拒绝域。

使用 $t=\frac{\bar{X}-\mu}{S/\sqrt{n}}$ 作为检验统计量，当观察值 $｜t｜=｜\frac{\bar{x}-\mu_0}{s/\sqrt{n}}|$ 过分大时就决绝 $H_0$，拒绝域的形式为
$$
｜t｜=｜\frac{\bar{x}-\mu_0}{s/\sqrt{n}}|\geq{k}
$$
由于当$H_0$ 为真时，$\frac{\bar{X}-\mu}{S/\sqrt{n}}\sim{t(n-1)}$，故
$$
P\{当H_0为真拒绝H_0\} = P_{\mu_0}\{|\frac{\bar{X}-\mu_0}{S/\sqrt{n}}|\geq{k}\}=\alpha
$$
得 $k=t_{\alpha/2}(n-1)$，即得拒绝域为
$$
｜t｜=｜\frac{\bar{x}-\mu_0}{s/\sqrt{n}}|\geq{t_{\alpha/2}(n-1)}
$$

次方法称为 $t$ **检验法**

- 两个总体均值

> 两个独立样本的总体标准差 $\sigma_1,\sigma_2$ 已知

适用条件：

1. 两个独立样本的总体标准差 $\sigma_1,\sigma_2$ 已知

2. 两个样本相互独立
3. 两个样本都是简单随机样本
4. 两个样本的总体服从正态分布或是样本容量 $n_1>30,n_2>30$

检验统计量
$$
Z=\frac{(\bar{X_1}-\bar{X_2})-(\mu_1-\mu_2)}{\sqrt{\frac{\sigma^2}{n_1}+\frac{\sigma_2^2}{n_2}}} \sim N(0,1)
$$

> 两个独立样本的总体标准差 $\sigma_1,\sigma_2$ 未知，但认为 $\sigma_1=\sigma_2$

设 $X_1,X_2,...,X_n$ 是来自正态总体 $N(\mu_1,\sigma^2)$ 的样本，$Y_1,Y_2,...,Y_n$ 是来自正态总体 $N(\mu_2,\sigma^2)$ 的样本，且设两样本独立。又分别记它们的样本均值为 $\bar{X},\bar{Y}$，记样本方差为 $S_1^2,S_2^2$。设 $\mu_1,\mu_2,\sigma^2$ 均为未知，要特别注意，在这里假设两总体的方差是相等的。现在求检验问题：
$$
H_0:\mu_1-\mu_2=\delta, \ H_1:\mu_1-\mu_2\neq{\delta}
$$
（$\delta$ 为已知常数）的拒绝域，取显著性水平为 $\alpha$.

检验统计量
$$
t = \frac{(\bar{X}-\bar{Y})-\delta}{S_w\sqrt{\frac{1}{n_1}+\frac{1}{n_2}}}
$$
其中
$$
S_w^2 = \frac{(n_1-1)S_1^2+(n_2-1)S_2^2}{n_1+n_2-2},S_w = \sqrt{S_w^2}
$$
当 $H_0$ 为真，$t\sim{t(n_1+n_2-2)}$，与单个总体的 $t$ 检验法相仿，其拒绝域的形式为
$$
|\frac{(\bar{x}-\bar{y})-\delta}{s_w\sqrt{\frac{1}{n_1}+\frac{1}{n_2}}}|\geq{k}
$$
由
$$
P\{当H_0为真拒绝H_0\}=P_{\mu_1-\mu_2=\delta}\{|\frac{(\bar{X}-\bar{Y})-\delta}{S_w\sqrt{\frac{1}{n_1}+\frac{1}{n_2}}}|\geq{k}\}=\alpha
$$
可得 $k=t_{\alpha/2}(n_1+n_2-2)$，于是得拒绝域为
$$
｜t｜=|\frac{(\bar{x}-\bar{y})-\delta}{s_w\sqrt{\frac{1}{n_1}+\frac{1}{n_2}}}|\geq{t_{\alpha/2}(n_1+n_2-2)}
$$

> 两个独立样本 $\sigma_1,\sigma_2$ 未知且不相等

适用条件：

1. 两个样板的总体标准差 $\sigma_1,\sigma_2$ 未知且不相等
2. 两个样本相互独立
3. 两个样本都是简单随机样本
4. 两个样本的总体服从正态分布或是样本容量 $n_1>30, n_2>30$

检验统计量
$$
t=\frac{(\bar{X_1}-\bar{X_2})-(\mu_1-\mu_2)}{\sqrt{\frac{s_1^2}{n_1}+\frac{s_2^2}{n_2}}} \sim t(v), v = \frac{(\frac{s_1^2}{n_1}+\frac{s_2^2}{n_2})^2}{\frac{(s_1^2/n_1)^2}{n_1}+\frac{s_2^2/n_2}{n_2}}
$$
简化计算， $v$ 可近似取 $\min(n_1-1, n_2-1)$



- 基于成对数据的检验（$t$ 检验）

有时为了比较两种产品、两种仪器、两种方法等的差异，我们常常在相同的条件下做对比试验，得到一批成对的观察值，然后分析观察数据做出推断，这种方法常称为**逐对比较法**。

一般，设有 $n$ 对相互独立的观察结果：$(X_1,Y_1),(X_2,Y_2),...,(X_n,Y_n)$，令 $D_1=X_1-Y_1,D_2=X_2-Y_2,...,D_n=X_n-Y_n$，则 $D_1,D_2,...,D_n$ 相互独立。又由于 $D_1,D_2,...,D_n$ 是由同一因素所引起的，可认为它们服从同一分布。今假设 $D_i\sim{N(\mu_D,\sigma_D^2),i=1,2,...,n}$。这就是说 $D_1,D_2,...,D_n$ 构成正态总体 $N(\mu_D,\sigma_D^2)$ 的一个样本，其中 $\mu_D,\sigma_D^2$ 未知。我们需要基于这一样本检验假设：
$$
(1) \ H_0:\mu_D=0, H_1:\mu_D\neq{0} \\
(2) \ H_0:\mu_D\leq{0}, H_1:\mu_D>{0} \\
(3) \ H_0:\mu_D\geq{0}, H_1:\mu_D<{0} \\
$$
分别记 $D_1,D_2,...,D_n$ 的样本值和样本方差的观察值为 $\bar{d},S_D^2$

检验统计量
$$
t = \frac{\bar{X}-\mu_0}{S/\sqrt{n}}
$$
检验问题的相应拒绝域分别为（显著水平为 $\alpha$）
$$
｜t｜ = ｜\frac{\bar{d}}{s_D/\sqrt{n}}｜\geq{t_{\alpha/2}{(n-1)}} \\
t = \frac{\bar{d}}{s_D/\sqrt{n}}\geq{t_{\alpha}{(n-1)}} \\
t = \frac{\bar{d}}{s_D/\sqrt{n}}\leq{-t_{\alpha}{(n-1)}} \\
$$

## 正态总体方差的假设检验

- 单个总体

设总体 $X\sim{N(\mu,\sigma^2)}$，其中 $\mu,\sigma^2$ 未知，$X_1,X_2,...,X_n$ 是来自 $X$ 的样本。要求检验假设（显著水平为 $\alpha$）
$$
H_0:\sigma^2=\sigma_0^2, H_1:\sigma^2\neq{\sigma_0^2}
$$
$\sigma_0^2$ 为已知常数。

由于 $S^2$ 是 $\sigma^2$ 的无偏估计，当 $H_0$ 为真时，观察值 $S^2$ 与 $\sigma_0^2$ 的比值 $\frac{s^2}{\sigma_0^2}$ 一般应在1附近摆动，而不应过分大于1或过分小于1。当 $H_0$ 为真时，
$$
\frac{(n-1)S^2}{\sigma_0^2}\sim{\chi^2(n-1)}
$$
检验统计量
$$
\chi^2 = \frac{(n-1)S^2}{\sigma_0^2}
$$
拒绝域的形式为
$$
\frac{(n-1)s^2}{\sigma_0^2}\leq{k_1} 或 \frac{(n-1)s^2}{\sigma_0^2}\geq{k_2}
$$
此处 $k_1,k_2$由下式确定
$$
P\{当H_0为真拒绝H_0\} = P_{\sigma_0^2}\{(\frac{(n-1)s^2}{\sigma_0^2}\leq{k_1})\cup( \frac{(n-1)s^2}{\sigma_0^2}\geq{k_2})\}=\alpha
$$
为方便计算，习惯上取
$$
P_{\sigma_0^2}\{\frac{(n-1)s^2}{\sigma_0^2}\leq{k_1}\}=\frac{\alpha}{2}，P_{\sigma_0^2}\{\frac{(n-1)s^2}{\sigma_0^2}\geq{k_2}\}=\frac{\alpha}{2}
$$
得 $k_1=\chi_{1-\alpha/2}^{2}{(n-1)},k_2=\chi_{\alpha/2}^{2}{(n-1)}$，于是拒绝域为
$$
\frac{(n-1)s^2}{\sigma_0^2}\leq{\chi_{1-\alpha/2}^{2}{(n-1)}} 或 \frac{(n-1)s^2}{\sigma_0^2}\geq{\chi_{\alpha/2}^{2}{(n-1)}}
$$
单边检验问题（显著性水平为 $\alpha$）
$$
H_0:\sigma^2\leq{\sigma_0^2},H_1:\sigma^2>\sigma_0^2
$$
因 $H_0$ 中的全部 $\sigma^2$ 都比 $H_0$ 中的 $\sigma^2$ 要小，当 $H_1$ 为真时，$S^2$ 的观察值 $s^2$ 往往偏大，因此拒绝域的形式为
$$
s^2\geq{k}
$$
下来确定常数 $k$
$$
\begin{align*}
P\{当H_0为真拒绝H_0\} 
&= P_{\sigma^2<\sigma_0^2}\{S^2\geq{k}\} \\
&= P_{\sigma^2<\sigma_0^2}\{\frac{(n-1)S^2}{\sigma_0^2}\geq{\frac{(n-1)k}{\sigma_0^2}}\} \\
&\leq{P_{\sigma^2<\sigma_0^2}\{\frac{(n-1)S^2}{\sigma^2}\geq{\frac{(n-1)k}{\sigma_0^2}}\}}
\end{align*}
$$
要控制 $P\{当H_0为真拒绝H_0\}$，只需令
$$
P_{\sigma^2<\sigma_0^2}\{\frac{(n-1)S^2}{\sigma^2}\geq{\frac{(n-1)k}{\sigma_0^2}}\}=\alpha
$$
因 $\frac{(n-1)S^2}{\sigma^2}\sim{\chi^2(n-1)}$ 得 $\frac{(n-1)k}{\sigma_0^2}=\chi_{\alpha}^2(n-1)$。于是 $k=\frac{\sigma_0^2}{n-1}{\chi_{\alpha}^2(n-1)}$，得拒绝域为
$$
s^2\geq{\frac{\sigma_0^2}{n-1}{\chi_{\alpha}^2(n-1)}}
$$
即
$$
\chi^2 = \frac{(n-1)s^2}{\sigma_0^2}\geq{\chi_{\alpha}^2(n-1)}
$$
类似地，可得左边检验问题
$$
H_0:\sigma^2\geq{\sigma_0^2},H_1:\sigma^2<\sigma_0^2
$$
的拒绝域为
$$
\chi^2 = \frac{(n-1)s^2}{\sigma_0^2}\leq{\chi_{1-\alpha}^2(n-1)}
$$
以上检验法称为 $\chi^2$ **检验法**

- 两个总体的情况

设 $X_1,X_2,...,X_{n_1}$ 是来自总体 $N(\mu_1,\sigma_1^2)$ 的样本，$Y_1,Y_2,...,Y_{n_2}$ 是来自总体 $N(\mu_1,\sigma_1^2)$ 的样本，且两样本独立。其样本方差分别为 $S_1^2, S_2^2$。且设 $\mu_1,\mu_2,\sigma_1^2,\sigma_2^2$ 均为未知。现在需要检验假设（显著水平为 $\alpha$）
$$
H_0:\sigma_1^2\leq{\sigma_2^2},H_1:\sigma_1^2>{\sigma_2^2}
$$
当 $H_0$ 为真时，$E(S_1^2)=\sigma_1^2\leq{\sigma_2^2}=E(S_2^2)$，当 $H_1$ 为真时 $E(S_1^2)=\sigma_1^2>{\sigma_2^2}=E(S_2^2)$。

当 $H_1$ 为真时，观察值 $\frac{S_1^2}{S_2^2}$ 有偏大的趋势，故拒绝域具有形式
$$
\frac{S_1^2}{S_2^2}\geq{k}
$$
常数 $k$ 确定如下：
$$
\begin{align*}
P\{当H_0为真拒绝H_0\} 
&= P_{\sigma_1^2<\sigma_2^2}\{\frac{S_1^2}{S_2^2}\geq{k}\} \\
&\leq{P_{\sigma_1^2<\sigma_2^2}\{\frac{S_1^2/S_2^2}{\sigma_1^2/\sigma_2^2}\geq{k}\}}
\end{align*}
$$
要控制 $P\{当H_0为真拒绝H_0\}\leq{\alpha}$，只需令
$$
P_{\sigma_1^2<\sigma_2^2}\{\frac{S_1^2/S_2^2}{\sigma_1^2/\sigma_2^2}\geq{k}\}=\alpha
$$
由于 $\frac{S_1^2/S_2^2}{\sigma_1^2/\sigma_2^2}\sim{F(n_1-1,n_2-2)}$，得 $k=F_{\alpha}{(n_1-1,n_2-1)}$。检验问题的拒绝域为
$$
F=\frac{s_1^2}{s_2^2}\geq{F_{\alpha}(n_1-1,n_2-1)}
$$
上式检验法称为 $F$**检验法**。

## 置信区间与假设检验的关系

设 $X_1,X_2,...,X_n$ 是一个来自总体的样本，$x_1,...,x_n$ 是相应的样本值，$\Theta$ 是参数 $\theta$ 的可能取值范围。设 $(\underline{\theta}(X_1,...,X_n),\bar{\theta}(X_1,...,X_n))$ 是参数 $\theta$ 的一个置信水平为 $1-\alpha$ 的置信区间，则对于任意 $\theta\in{\Theta}$，有
$$
P_{\theta}\{\underline{\theta}(X_1,...,X_n)<\theta<\bar{\theta}(X_1,...,X_n)\}=1-\alpha
$$
置信水平为 $1-\alpha$ 的置信区间为：$(\underline{\theta}(X_1,...,X_n),\bar{\theta}(X_1,...,X_n))$ ，显著水平为 $\alpha$ 假设检验$H_0:\theta=\theta_0,H_1:\theta\neq{\theta_0}$的接受域为：$\underline{\theta}(x_1,...,x_n)<\theta_0<\bar{\theta}(x_1,...,x_n)$

置信水平为 $1-\alpha$ 的单侧置信区间为：$(-\infty,\bar{\theta}(X_1,...,X_n))$ ，显著水平为 $\alpha$ 左边假设检验$H_0:\theta\geq\theta_0,H_1:\theta<{\theta_0}$的接受域为：$-\infty<\theta_0\leq\bar{\theta}(x_1,...,x_n)$

置信水平为 $1-\alpha$ 的置信区间为：$(\underline{\theta}(X_1,...,X_n),\infty)$ ，显著水平为 $\alpha$ 右边假设检验$H_0:\theta\leq \theta_0,H_1:\theta\geq{\theta_0}$的接受域为：$\underline{\theta}(x_1,...,x_n)<\theta_0<\infty$

## 样本容量的选取

## 分布拟合检验

上面的各种检验法都是在总体分布形式为已知的前提下进行讨论的。但在实际问题中，有时不能知道总体服从什么类型的分布，这时就需要根据样本来检验关于分布的假设。这里介绍 $\chi^2$ 拟合检验法。可以用来检验总体是否具有某一个指定的分布或属于某一个分布族。

- 单个分布的 $\chi^2$ 的拟合检验法

> 检验假设

设总体 $X$ 的分布未知，$x_1,x_2,...,x_n$ 是来自 $X$ 的样本值，我们来检验假设

$H_0$ : 总体 $X$ 的分布函数为 $F(x)$

$H_1$ : 总体 $X$ 的分布函数不是 $F(x)$

其中设 $F(x)$ 不含未知参数。（也常以分布律或概率密度代替 $F(x)$）

> 检验统计量

将在 $H_0$ 下 $X$ 可能取值的全体 $\Omega$ 分称互不相交的子集 $A_1,A_2,...,A_k$，以 $f_{i}(i=1,2,...,k)$ 记样本观察值 $x_1,x_2,...,x_n$ 中落在 $A_i$ 的个数，这表示事件 $A_i=\{X的值落在子集A_i内\}$ 在 $n$ 次独立试验中发生 $f_i$ 次，于是在这 $n$ 次试验中事件 $A_i$ 发生的频率为 $f_i/n$。另一方面，当 $H_0$ 为真时，我们可以根据 $H_0$  中所假设的 $X$ 的分布函数来计算事件 $A_i$ 的概率，得到 $p_i=P(A_i),i=1,2,...,k$。频率 $f_i/n$ 与概率 $p_i$ 会有差异，但一般来说，当 $H_0$ 为真，且试验的次数又很多时，这种差异不应太大，因此 $(\frac{f_i}{n}-p_i)^2$ 不应太大。我们采用形如
$$
\sum_{i=1}^{k}{(\frac{f_i}{n}-p_i)^2}
$$
的统计量来度量样本与 $H_0$ 中所假设的分布的吻合程度，其中 $C_i(i=1,2,...,k)$ 为给定的常数。皮尔逊证明，如果选取 $C_i=n/p_i(i=1,2,...,k)$，则上面的统计量具有下述定义中所述的简单性质，于是就采用
$$
\chi^2 = \sum_{i=1}^{k}{\frac{n}{p_i}(\frac{f_i}{n}-p_i)^2}=\sum_{i=1}^{k}{\frac{f_i^2}{np_i}}-n
$$
作为检验统计量

**定理**

若 $n$ 充分大（$n\ge 50$），则当 $H_0$ 为真时统计量近似服从 $\chi^2(k-1)$ 分布。

> 拒绝域

当 $H_0$ 为真时，$\chi^2$ 不应太大，如 $\chi^2$ 过分大就拒绝 $H_0$。拒绝域的形式为
$$
\chi^2\geq{G} (G为正常数)
$$
对于给定的显著性水平 $\alpha$，确定 $G$ 使
$$
P\{当H_0为真拒绝H_0\} =P_{H_0}\{\chi^2\geq G\}=\alpha
$$
由上述定理得 $G=\chi_{\alpha}^2(k-1)$。即当样本观察值使式中的 $\chi^2$ 的值有
$$
\chi^2\ge \chi_{\alpha}^2(k-1)
$$
则在显著水平 $\alpha$ 下拒绝 $H_0$；否则就接受 $H_0$。这就是单个分布的 $\chi^2$ **拟合检验法**

$\chi^2$ 拟合检验法是基于上述定理得到的，所以使用时必须注意 $n$ 不能小于50，另外 $np_i$ 不能太小，应有 $np_i\ge 5$，否则应适当合并 $A_i$，以满足这个要求。

- 分布族的 $\chi^2$ 拟合检验

> 检验假设

在单个分布的 $\chi^2$ 的拟合检验法中，总体 $X$ 的分布函数 $F(x)$ 是已知的，但是常遇到的原假设是

$H_0$ ：总体 $X$ 的分布函数是 $F(x:\theta_1,...,\theta_r)$

其中 $F$ 形式已知，而 $\theta = (\theta_1,\theta_2,...,\theta_r)$ 是未知参数，它们在某一个范围取值。在 $F(x;\theta_1,\theta_2,...,\theta_r)$ 中当参数 $\theta_1,\theta_2,...,\theta_r$ 取不同的值时，就得到不同的分布，因而$F(x;\theta_1,\theta_2,...,\theta_r)$ 代表一族分布。$H_0$ 表示总体 $X$ 的分布属于分布族$F(x;\theta_1,\theta_2,...,\theta_r)$ 。

> 检验统计量

将在 $H_0$ 下 $X$ 可能取值的全体 $\Omega$ 分成 $k(k>r+1)$ 个互不相交的子集 $A_1,A_2,...,A_k$，以$f_{i}(i=1,2,...,k)$ 记样本观察值 $x_1,x_2,...,x_n$ 中落在 $A_i$ 的个数，则事件 $A_i=\{X的值落在子集A_i内\}$ 的频率为 $f_i/n$。另一方面，当 $H_0$ 为真时，由 $H_0$  中所假设的 $X$ 的分布函数来计算 $P(A_i)$，得到 $P(A_i)=p_i(\theta_1,\theta_2,...,\theta_r)=p_i(\theta)=p_i$。此时，需先利用样本求出未知参数的最大似然估计（在 $H_0$ 下），以估计值作为参数值，求出 $p_i$ 的估计值 $\hat{p_i}=\hat{P}(A_i)$，在检验统计量中使用 $\hat{p_i}$ 替代 $p_i$，则检验假设 $H_0$ 的统计量
$$
\chi^2 = \sum_{i=1}^{k}{\frac{f_i^2}{n\hat{p_i}}}-n
$$
在某些条件下，在 $H_0$ 为真时近似地有
$$
\chi^2 = \sum_{i=1}^{k}{\frac{f_i^2}{n\hat{p_i}}}-n\sim{\chi^2(k-r-1)}
$$

> 拒绝域

假设检验问题的拒绝域为
$$
\chi^2\ge \chi_{\alpha}^2(k-r-1)
$$
$\alpha$ 为显著水平。以上就是用来检验分布族的 $\chi^2$ 拟合检验法

- 偏度、峰度检验

由中心极限定理知道，正态分布随机变量时较广泛地存在的。因此，研究一连续型总体时，往往优先考察它是否服从正态分布，$\chi^2$ 拟合检验法虽然是检验总体分布的较一般的方法。但用它来检验总体的正态性，犯第2类错误的概率往往较大。为此，统计学家发现“偏度、峰度检测法”及“夏皮罗-威尔克法”较为有效果。

随机变量 $X$ 的偏度和峰度指的是 $X$ 的标准化变量 $[X-E(X)]/\sqrt{D(X)}$ 的三阶矩和四阶矩：
$$
\nu_1=E[(\frac{X-E(X)}{\sqrt{D(X)}})^3]=\frac{E[(X-E(X))^3]}{(D(X))^{3/2}}, \\
\nu_2=E[(\frac{X-E(X)}{\sqrt{D(X)}})^4]=\frac{E[(X-E(X))^4]}{(D(X))^{2}}
$$
当随机变量 $X$ 服从正态分布时， $\nu_1=0$ 且 $\nu_2=3$。

设 $X_1,X_2,...,X_n$ 是来自总体 $X$ 的样本，则 $\nu_1,\nu_2$ 的据估计量分别是
$$
G_1=B_3/B_2^{3/2},G_2=B_4/B_2^2
$$
其中 $B_k(k=2,3,4)$ 是样本 $k$ 中心矩，并分别称 $G_1,G_2$ 为样本偏度和样本峰度。



若总体 $X$ 为正态变量，则可证当 $n$ 充分大时，近似地有
$$
G_1\sim{N(0, \frac{6(n-2)}{(n+1)(n+3)})},\\
G_2\sim{N(3-\frac{6}{n+1},\frac{24n(n-2)(n-3)}{(n+1)^2(n+3)(n+5)})}
$$
设$X_1,X_2,...,X_n$ 是来自总体 $X$ 的样本，现在检验假设

$H_0$：$X$ 为正态总体

记
$$
\sigma_1=\sqrt{\frac{6(n-2)}{(n+1)(n+3)}},\sigma_2=\sqrt{\frac{24n(n-2)(n-3)}{(n+1)^2(n+3)(n+5)}}\\
\mu_2=3-\frac{6}{n+1},U_1=\frac{G_1}{\sigma_1},U_2=(G_2-\mu_2)/\sigma_2
$$
当 $H_0$ 为真且 $n$ 充分大时，近似地有
$$
U_1\sim{N(0,1)},U_2\sim{N(0,1)}
$$
样本偏度 $G_1$、样本峰度 $G_2$ 分别依概率收敛于总体偏度 $\nu_1$ 和总体峰度 $\nu_2$。因此当 $H_0$ 为真且 $n$ 充分大时，一般来说，$G_1$与 $\nu_1=0$ 的偏离不太大，而 $G_2$ 与 $\nu_2=3$ 的偏离不应太大。故从直观来看当 $｜U_1｜$的观察值 $｜u_1｜$ 或  $｜U_2｜$的观察值 $｜u_2｜$ 过大时就拒绝 $H_0$。取显著性水平为 $\alpha, H_0$ 的拒绝域为
$$
｜u_1｜\ge k_1,|u_2|\ge k_2
$$
其中 $k_1,k_2$ 由以下两式确定
$$
P_{H_0}\{|U_1|\ge k_1\}=\frac{\alpha}{2},P_{H_0}\{|U_2|\ge k_2\}=\frac{\alpha}{2}
$$
这里记号 $P_{H_0}\{\cdot\}$ 表示当 $H_0$ 为真时时间 $\{\cdot\}$ 的概率，即有 $k_1=z_{\alpha/4}, k_2=z_{\alpha/4}$.于是拒绝域为
$$
｜u_1｜\ge z_{\alpha/4},|u_2|\ge z_{\alpha/4}
$$
事实上当 $n$ 充分大时有
$$
\begin{align*}
P\{当H_0为真拒绝H_0\} 
&= P_{H_0}\{(|U_1|\ge{z_{\alpha/4}})\cup{(|U_2|\ge{z_{\alpha/4}})}\} \\
&\leq {P_{H_0}\{|U_1|\ge{z_{\alpha/4}}\}+P\{|U_2|\ge{z_{\alpha/4}})}\} \\
&=\frac{\alpha}{2}+\frac{\alpha}{2}=\alpha
\end{align*}
$$

## 秩和检验

## 假设检验问题的p值法

以上讨论的假设检验方法为**临界值法**。还有一种称为 $p$ 值法的检验方法

> 定义

假设检验问题 的 $P$ 值是由检验统计量的样本观察值得出原假设可被拒绝的最小显著性水平。

常用的检验问题的 $p$ 值可以根据检验统计量的样本观察值以及检验统计量在 $H_0$ 下一个特定的参数值（一般是 $H_0$ 与 $H_1$ 所规定的参数的分界点）对应的分布求出。

在现代计算机统计软件中，一般都给出检验问题的 $p$ 。

按 $p$ 值的定义，对于任意指定的显著性水平 $\alpha$，就有

（1）若 $p\leq \alpha$，则在显著性水平 $\alpha$ 下拒绝 $H_0$。

（2）若 $p>\alpha$，则在显著性水平 $\alpha$ 下接受 $H_0$。

有了这两条结论就能方便地确定是否拒绝 $H_0$。这种利用 $p$ 值来确定是否拒绝 $H_0$ 的方法，称为 $p$ **值法**。

 ## 决定规则

| 方法       | 拒绝零假设                                    | 不拒绝零假设                   |
| ---------- | --------------------------------------------- | ------------------------------ |
| 临界值法   | 检验统计量落在拒绝域                          | 检验统计量不落在拒绝域         |
| p值法      | $p\leq \alpha$                                | $p>\alpha$                     |
| 另一个选择 | 不采用具体的 $\alpha$ 值，写出p值留给读者判断 |                                |
| 置信区间   | 置信区间中没有包含零假设的参数值              | 置信区间中有包含零假设的参数值 |


# 网络编程

## 基础

`System.Net`和`System.Net.Sockets`是`.Net Frame work SDK`为C#开发网络应用程序提供的两个重要的命名空间。

.Net在`System.Net`命名空间下定义了处理关于IP地址的类：`IPAddress, IPEndPoint, Dns, IPHostEntry`

### IPAddress

IPAddress类主要提供了网际协议(IP)地址。构造IP地址实例是通过IPAddress类来实现的。

- 属性

| name         | desc                                                         |
| ------------ | ------------------------------------------------------------ |
| Any          | 表示本地系统可用的任何IP地址，指示服务器应侦听所有网络接口上的客户端活动 |
| Broadcast    | 表示本地网络的IP广播地址                                     |
| IPv6Any      | SocketBind方法用此字段指出本地系统的可用的IP地址             |
| IPv6Loopback | 表示系统的回送地址                                           |
| IPv6None     | 以字节数组形式提供IPAddress的副本                            |
| Loopback     | 表示系统的回送地址                                           |
| None         | 表示系统上没有可用的网络接口                                 |

- 方法

| 构造函数名                 | desc                                                 |
| -------------------------- | ---------------------------------------------------- |
| `IPAddress(Byte[])`        | 用指定为Byte数组的地址初始化新实例                   |
| `IPAddress(Int64)`         | 用指定为Int64的地址初始化新实例                      |
| `IPAddress(Byte[], Int64)` | 用指定为Byte数组的地址和指定的范围标识符初始化新实例 |

由于构造函数繁琐且不直观，更多情况下使用成员方法构造

| name              | desc                              |
| ----------------- | --------------------------------- |
| `Parse`           | 将IP地址字符串转换为IPAddress实例 |
| `TryParse`        | 确定字符串是否为有效的IP地址      |
| `MapToIPv4`       | 将IPAddress对象映射到IPv4地址     |
| `IsLoopback`      | 指示指定的IP地址是否为环回地址    |
| `GetAddressBytes` | 以字节数组形式提供IPAddress的副本 |
| `Equals`          | 比较两个IP地址                    |

示例

```c#
IPAddress test1 = IPAddress.Parse("192.168.1.1");  // 将字符串转换为IPAddress实例
IPAddress test2 = IPAddress.Loopback;
IPAddress test3 = IPAddress.Broadcast;
IPAddress test4 = IPAddress.Any;
IPAddress test5 = IPAddress.None;
```

### Dns

Dns类在.NET的`System.net`命名空间下，主要功能是从Internet域名系统检索关于特定主机的信息。Dn类是一个静态类，提供了一系列静态的方法，用于获取提供本地或远程域名等功能。

| 成员方法                      | desc                                                |
| ----------------------------- | --------------------------------------------------- |
| `GetHostAddress()`            | 返回指定主机的Internet协议(IP)地址                  |
| `GetHostEntry(IPAddress)`     | 将IP地址解析为IPHostEntry实例                       |
| `GetHostEntry(String)`        | 将主机名或IP地址解析为IPHostEntry实例               |
| `GetHostName()`               | 获取本机的主机名                                    |
| `GetHOstAddressAsync()`       | 返回指定主机的IP地址以作为异步操作                  |
| `GetHOstEntrysync(IPAddress)` | 将IP地址解析为IPHostEntry实例以作为异步操作         |
| `GetHostEntrysync(String)`    | 将主机名或IP地址解析为IPHostEntry实例以作为异步操作 |

示例

```c#
string hostname = "www.baidu.com";
ips = Dns.GetHostAddress(hostname);
foreach(IPAddress ip in ips)
{
  Console.WriteLine("{0}", ip)
}
```

### IPHostEntry

`IPHostEntry`类的实例对象包含了Internet主机的地址相关信息。此类型的所有公共静态成员对多线程操作而言都是安全的，但不保证任何实例成员是线程安全的。

`IPHostEntry`类将一个域名系统主机与一组别名和一组匹配的IP地址关联，通常和DNS类一起使用。在DNS类中，有获取`IPHostEntry`对象的方法`GetHostEntry`，然后通过`IPHostEntry`对项，可以获取本地或远程主机的相关IP地址

- 属性

| name        | desc                                                         |
| ----------- | ------------------------------------------------------------ |
| AddressList | 获取或设置与主机关联的IP地址列表，值是IPAddress类型的数组，包含解析为Aliases属性中包含的主机名的IP地址 |
| Aliases     | 获取或设置与主机关联的别名列表，值是一组字符串，包含解析为AddressList属性中的IP地址的DNS名 |
| HostName    | 包含了服务器的主要主机名                                     |

示例

```c#
IPHostEntry results = Dns.GetHostEntry("www.baidu.com");
string hostname = results.HostName; // 主机名
foreach(string alias in results.Aliases)
{
  	Console.WriteLine(alias);// 主机别名
}
foreach(IPAddress address in results.AddressList)
{
  	Console.WriteLine(address.ToString());// 主机地址
}
```

### IPEndPoint

在Internet中，TCP/IP使用一个网络地址和一个服务端口号来唯一识别设备。网络地址标识网络上的特定设别；端口好标识要连接到的该设备上的特定服务。网络地址和服务端口的组合称为终结点，在.NET框架中正是由EndPoint类表示这个终结点，它提供表示网络资源或服务的抽象，用以标志网络地址等信息。.NET同时也为每个受支持的地址族定义了EndPoint的子类；对于IP地址族，该类为IPEndPoint。IPEndPoint类包含应用程序连接到主机上的服务所需的主机和端口信息，通过组合服务的主机IP地址和端口号，IPEndPoint类形成到服务的连接点。

IPEndPoint是与IPAddress概念相关的一个类，它在IP地址的基础上还包含了端口的信息。通过组合服务的主机IP地址和端口号，IPEndPoint类形成到服务器的连接点。在IPEndPoint类中有两个常用的构造函数

```c#
public IPEndPoint(long, int);
public IPEndPoint(IPAddress, int);
```

- 属性

| name          | desc                     |
| ------------- | ------------------------ |
| Address       | 获取或设置终结点的IP地址 |
| AddressFamily | 获取IP地址族             |
| Port          | 获取或设置终结点的端口号 |

示例

```c#
IPAddress NewAddress = IPAddress.Parse("192.168.1.1");
IPEndPoint Ex = new IPEndPoint(NewAddress, 8000);// 创建IPEndPoint对象Ex
Console.WriteLine("IPEndPoint: ", Ex.ToString());
Console.WriteLine("AddressFamily: ", Ex.AddressFamily);//IP地址族
Console.WriteLine("Address:{0}, port:{1}", Ex.address, Ex.Port);//IP地址和端口
Console.WriteLine("MinPortNum:{0}", IPEndPoint.MinPort);
Console.WriteLine("MaxPortNum:{0}", IPEndPoint.MaxPort);
Ex.Port = 80;//修改端口号为80
Console.WriteLine("CIPEndPoint:{0}", Ex.ToString());
SocketAddress Sa = Ex.Serialize();
Console.WriteLine("SocketAddress:{0}", Sa.ToString());
Console.Read();
```



## Socket

### 概述

### 面向连接

### 无连接

### NetworkStream

## TCP

### TcpClient

### TcpListener

### 同步编程

### 异步编程

## UDP


# 跨域请求

[参考](https://blog.csdn.net/apple9005/article/details/54427902)

- 方法一：AJAX

```
使用Ajax获取json数据时，存在跨域的限制。不过，在Web页面上调用js的script脚本文件时却不受跨域的影响，JSONP就是利用这个来实现跨域的传输。因此，我们需要将Ajax调用中的dataType从JSON改为JSONP（相应的API也需要支持JSONP）格式。 
JSONP只能用于GET请求。

$.ajax({
  dateType:'jsonp',  
})
```

- 方法二：视图函数

修改views.py中对应API的实现函数，允许其他域通过Ajax请求数据

```python
def myview(_request): 
	response = HttpResponse(json.dumps({“key”: “value”, “key2”: “value”})) 
	response[“Access-Control-Allow-Origin”] = “*” 
	response[“Access-Control-Allow-Methods”] = “POST, GET, OPTIONS” 
	response[“Access-Control-Max-Age”] = “1000” 
	response[“Access-Control-Allow-Headers”] = “*” 
	return response
```

- 方法三：中间件

```python
from django.utils.deprecation import MiddlewareMixin

class AuthenticationMiddleware(MiddlewareMixin):
		 def process_response(self, request, response):
        try:
            ip = request.META.get('HTTP_ORIGIN')
            response["Access-Control-Allow-Origin"] = ip
            response["Access-Control-Allow-Credentials"] = 'true'
            response["Access-Control-Allow-Methods"] = "POST, GET, OPTIONS"
            response["Access-Control-Allow-Headers"] = "Origin, X-Requested-With, Content-Type, Accept"
            response["Access-Control-Max-Age"] = "1728000"
        except Exception as e:
            print(e)
        return response
```

- 方法四：插件

安装django-cors-headers

```
pip install django-cors-headers
```

配置setting.py文件

```python
INSTALLED_APPS = [
    ...
    'corsheaders'，
    ...
 ] 

MIDDLEWARE_CLASSES = (
    ...
    'corsheaders.middleware.CorsMiddleware',
    'django.middleware.common.CommonMiddleware', # 注意顺序
    ...
)
#跨域增加忽略
CORS_ALLOW_CREDENTIALS = True
CORS_ORIGIN_ALLOW_ALL = True
CORS_ORIGIN_WHITELIST = (
    '*'
)

CORS_ALLOW_METHODS = (
    'DELETE',
    'GET',
    'OPTIONS',
    'PATCH',
    'POST',
    'PUT',
    'VIEW',
)

CORS_ALLOW_HEADERS = (
    'XMLHttpRequest',
    'X_FILENAME',
    'accept-encoding',
    'authorization',
    'content-type',
    'dnt',
    'origin',
    'user-agent',
    'x-csrftoken',
    'x-requested-with',
    'Pragma',
)
```

